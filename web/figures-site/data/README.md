# Figures Site Data Configuration

This directory contains configuration files for the Next.js figures gallery.

## Files

### `special-figures.json`

Main configuration file defining the figure groups displayed on the special figures page.

**Important:** The PheWAS Manhattan plots (files matching `phewas_plots/phewas_chr*.pdf`) are **automatically generated** during build and should NOT be hardcoded in this file. The build process will inject them based on statistical significance.

### `phewas-figures.json` (auto-generated)

This file is automatically generated by `scripts/generate_phewas_figures_json.py` during the build process. It contains the list of PheWAS Manhattan plots to display, based on the same logic as `forest.py`:

- **Selection criteria:** Any inversion with at least one phenotype association where `Q_GLOBAL ≤ 0.05` (FDR-significant)
- **Data source:** `data/phewas_results.tsv`
- **Mapping source:** `data/inv_properties.tsv` (maps inversion IDs to genomic coordinates)

Do not edit this file manually - it will be overwritten during the next build.

## How PheWAS Plots Are Included

During `npm run build`, the following happens:

1. **Pre-build step:** `scripts/generate_phewas_figures_json.py` runs automatically (configured in `package.json` as `prebuild` script)
2. **Filtering:** The script reads `data/phewas_results.tsv` and filters for associations with `Q_GLOBAL ≤ 0.05`
3. **Mapping:** Inversion IDs (like `chr10-79542902-INV-674513`) are mapped to genomic coordinates (like `chr10:79,542,901-80,217,413`) using `data/inv_properties.tsv`
4. **Output:** Generates `phewas-figures.json` with the list of significant inversions
5. **Build time:** `pages/special/index.tsx` reads `phewas-figures.json` and injects the Manhattan plots into the PheWAS section

## Manually Regenerating PheWAS Figures List

To regenerate the list without doing a full build:

```bash
python3 scripts/generate_phewas_figures_json.py
```

This will update `web/figures-site/data/phewas-figures.json`.

## Adding Other PheWAS Figures

Non-Manhattan PheWAS figures (like forest plots, volcano plots, heatmaps) should be added directly to the `figures` array in the `"phewas"` section of `special-figures.json`. They will be combined with the auto-generated Manhattan plots.
